<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konverter WebP (Auto Resize 1167x778)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .dashed-border {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%234F46E5FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        .file-card { transition: all 0.3s ease; }
        .file-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <h1 class="font-bold text-xl tracking-tight text-slate-900">WebP<span class="text-indigo-600">Resizer</span></h1>
            </div>
            <div class="text-sm text-slate-500 font-medium bg-slate-100 px-3 py-1 rounded-full">
                ðŸ”’ Auto Resize 1167x778
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        
        <!-- Header Section -->
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold text-slate-900 sm:text-4xl mb-3">Convert & Resize ke 1167x778</h2>
            <p class="text-lg text-slate-600 max-w-2xl mx-auto">
                Upload gambar apa saja. Hasil output otomatis format <strong>WebP</strong> dengan resolusi <strong>1167x778 piksel</strong> (Stretch).
            </p>
        </div>

        <!-- Controls & Dropzone -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            
            <!-- Quality Slider -->
            <div class="mb-8 max-w-lg mx-auto">
                <div class="flex justify-between mb-2">
                    <label for="quality" class="text-sm font-semibold text-slate-700">Kualitas Gambar</label>
                    <span id="qualityValue" class="text-sm font-bold text-indigo-600">80%</span>
                </div>
                <input type="range" id="quality" min="0.1" max="1" step="0.05" value="0.8" 
                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                <p class="text-xs text-slate-400 mt-1 text-center">Geser ke kiri untuk kompresi lebih tinggi.</p>
            </div>

            <!-- Drop Zone -->
            <div id="dropZone" class="relative group cursor-pointer">
                <input type="file" id="fileInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" multiple accept="image/png, image/jpeg, image/jpg, image/bmp">
                
                <div class="dashed-border rounded-2xl p-10 flex flex-col items-center justify-center bg-slate-50 group-hover:bg-indigo-50 transition-colors duration-200 h-64">
                    <div class="bg-white p-4 rounded-full shadow-sm mb-4 group-hover:scale-110 transition-transform duration-200">
                        <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                    </div>
                    <p class="text-lg font-semibold text-slate-700 mb-1">Klik atau Drag & Drop Gambar</p>
                    <p class="text-sm text-slate-500">Output akan otomatis menjadi 1167x778px</p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsContainer" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-slate-800">Hasil Konversi</h3>
                <button onclick="clearAll()" class="text-sm text-red-500 hover:text-red-700 font-medium">Hapus Semua</button>
            </div>
            <div id="resultsList" class="grid grid-cols-1 gap-4">
                <!-- Items will be injected here -->
            </div>
        </div>

    </main>

    <!-- Hidden Canvas for Processing -->
    <canvas id="canvas" class="hidden"></canvas>

    <script>
        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const qualityInput = document.getElementById('quality');
        const qualityValue = document.getElementById('qualityValue');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsList = document.getElementById('resultsList');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // State
        let currentQuality = 0.8;
        const TARGET_WIDTH = 1167;
        const TARGET_HEIGHT = 778;

        // Event Listeners
        qualityInput.addEventListener('input', (e) => {
            currentQuality = parseFloat(e.target.value);
            qualityValue.textContent = `${Math.round(currentQuality * 100)}%`;
        });

        // Drag & Drop Visual Effects
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.querySelector('.dashed-border').classList.add('bg-indigo-50');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.querySelector('.dashed-border').classList.remove('bg-indigo-50');
            });
        });

        dropZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            // Reset input so same files can be selected again if needed
            fileInput.value = ''; 
        });

        // Main Logic
        function handleFiles(files) {
            if (files.length > 0) {
                resultsContainer.classList.remove('hidden');
                Array.from(files).forEach(processFile);
            }
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        function processFile(file) {
            // Validate image type
            if (!file.type.match(/image.*/)) {
                alert('File harus berupa gambar!');
                return;
            }

            // Create unique ID for UI element
            const id = 'img-' + Math.random().toString(36).substr(2, 9);
            
            // Create UI Skeleton
            const itemHTML = createItemSkeleton(id, file.name, file.size);
            resultsList.insertAdjacentHTML('afterbegin', itemHTML);

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    // === MODIFIKASI DIMENSI ===
                    canvas.width = TARGET_WIDTH;
                    canvas.height = TARGET_HEIGHT;
                    
                    // Draw image on canvas (STRETCHED)
                    // drawImage(image, x, y, width, height)
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, TARGET_WIDTH, TARGET_HEIGHT);

                    // Convert to WebP
                    canvas.toBlob((blob) => {
                        updateItemSuccess(id, blob, file.size);
                    }, 'image/webp', currentQuality);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function createItemSkeleton(id, name, originalSize) {
            return `
            <div id="${id}" class="file-card bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <div class="w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center animate-pulse">
                        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-900 truncate max-w-[200px]">${name}</p>
                        <p class="text-xs text-slate-500">Asli: ${formatBytes(originalSize)}</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 w-full sm:w-auto justify-end status-area">
                    <span class="text-xs font-semibold bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full animate-pulse">Memproses...</span>
                </div>
            </div>
            `;
        }

        function updateItemSuccess(id, blob, originalSize) {
            const el = document.getElementById(id);
            if (!el) return;

            const url = URL.createObjectURL(blob);
            const savedSize = originalSize - blob.size;
            const savedPercent = ((savedSize / originalSize) * 100).toFixed(1);
            const isSmaller = savedSize > 0;
            const newName = el.querySelector('p').innerText.replace(/\.[^/.]+$/, "") + ".webp";

            // Update Icon
            const iconContainer = el.querySelector('.w-12');
            iconContainer.classList.remove('animate-pulse', 'bg-slate-100');
            iconContainer.classList.add('bg-green-100');
            iconContainer.innerHTML = `<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;

            // Update Status Area
            const statusArea = el.querySelector('.status-area');
            statusArea.innerHTML = `
                <div class="text-right mr-2 hidden sm:block">
                    <p class="text-sm font-bold text-slate-800">${formatBytes(blob.size)}</p>
                    <p class="text-xs text-slate-500">
                        1167x778px (WebP)
                    </p>
                </div>
                <a href="${url}" download="${newName}" class="flex items-center justify-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm w-full sm:w-auto">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    Download
                </a>
            `;
        }

        function clearAll() {
            resultsList.innerHTML = '';
            resultsContainer.classList.add('hidden');
        }
    </script>
</body>
</html>
